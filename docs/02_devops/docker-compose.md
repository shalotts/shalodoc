---
parent: DevOps
title: Docker Compose API
---

# Docker Compose API

::: warning
Текст не отформатирован
:::

## Проверка здоровья

::: info
Стандарт [Health Check Response Format for HTTP APIs](https://inadarei.github.io/rfc-healthcheck/)
:::

Если взглянуть на [заготовку файла](/assets/docker/s1/docker-compose.yml) 
можно заметить весьма нестандартные вещи, крайне необходимые для наших приложений в проде, 
например параметр [healthcheck](https://dotsandbrackets.com/docker-health-check-ru/).

У серверной части разработчики по идеи должны прописывать маршруты для проверки состояния. Самый простой
это отправить запрос курлом в стиле /healthcheck и получить ответ `OK`.
Данный подход лучше, чем пинговать ресурс или отправить `curl` на главную страницу (там нас ждёт 
лишний мусор в виде html, к тому же разработчики могут повесить проверки на внутренние сервисы и 
утилиты).

Однако это не гарантирует что все маршруты работают 100% исправно. Операции происходят ни только на сервере, но и у клиента
в браузере. Проверять через определенные интервалы времени занятие весьма дорогое (даёт нагрузку на сервер), поэтому большая
часть тестов проводится каждый раз при сборке приложения (`good`: слияние веток с основной или с 
`best`: тестовой).

Под исключение попадает запросы к чужому API, их нужно прописывать к healthcheck (желательно на стороне разрабов). 
Такое API может оказаться недоступным
в непредсказуемый момент.

## Лимиты

Разработчики могут использовать ресурсы выше стандартных норм, однако это не всегда оправдано. Прожорливый контейнер
может отразиться на работе других сервисов, старайтесь прописывать максимально значение

```yaml
version: "3.4"
services:
  node:
    image: USER/Your-Pre-Built-Image
	...Прочие опции
    deploy:
      resources:
        limits:
          cpus: '0.001'
          memory: 50M
        reservations:
          cpus: '0.0001'
          memory: 20M
```

## ENV VARS

Старайтесь хранить все переменные в отдельном .env (/assets/docker/s1/.env.intra) файле


## Entrypoints

Некоторые контейнеры позволяют пробрасывать файлы для инициализации.
В случае если нету entrypoint используйте `command: "Ваша баш команда"`, но в этом случае 
команда будет срабатывать всегда при перезапуске контейнера, используйте [баш проверки](https://sentry.io/answers/determine-whether-a-file-exists-or-not-in-bash/)

```yaml
    volumes:
      - entry_db:/docker-entrypoint-initdb.d

```

У `postgress` можно заметить volume для